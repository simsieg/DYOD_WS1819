# https://github.com/Miroka96/docker-makefile

NAME = hyrise/opossum
TAG = 1.0

VOLUME = ${PWD}
MOUNTPATH = /project

#LOCALPORT = 8080
#CONTAINERPORT = 80

# if you want a special image name, edit this
IMAGE = $(NAME):$(TAG)

# if you have no volume, delete the right part
VOLUMEMOUNTING = -v $(VOLUME):$(MOUNTPATH)

# if you publish no ports, delete the right part
PORTPUBLISHING = #-p $(LOCALPORT):$(CONTAINERPORT)

PROGRAMRAW=docker run $(VOLUMEMOUNTING) $(PORTPUBLISHING) --rm
PROGRAM=$(PROGRAMRAW) $(IMAGE)

.PHONY: build test test-shell build-test deploy build-deploy undeploy redeploy build-redeploy clean-volume clean-container clean install-dependencies configure

build-container:
	docker build -t $(IMAGE) .

build-container-nocache:
	docker build -t $(IMAGE) --no-cache .

init-test:
	$(PROGRAM)

build-container-test: build-container init-test

hi:
	set HI=hi >/dev/null

echo: hi
	echo $(HI)

configure:
	$(PROGRAM) configure

build:
	$(PROGRAM) build

lint:
	$(PROGRAM) lint

format:
	$(PROGRAM) format

test:
	$(PROGRAM) test

coverage:
	$(PROGRAM) coverage

sanitize:
	$(PROGRAM) sanitize

debug:
	$(PROGRAM) debug

git-update:
	$(PROGRAM) git-update

ssh:
	$(PROGRAM) ssh

deploy-container:
	echo nothing to deploy yet

build-container-deploy: build-container deploy-container

stop-container:
	-docker stop $(NAME)

clean-container:
	-docker rm $(NAME)

undeploy-container: stop-container clean-container

redeploy-container: undeploy-container deploy-container

build-container-redeploy: build-container redeploy-container
